#!/bin/bash

SCRIPT=$(readlink -f $BASH_SOURCE[0])
SCRIPT_DIR=$(dirname $SCRIPT)
source $SCRIPT_DIR/config.sh

# Hadoop
sed -i 's,CONFIGURE_YARN_TMP_DIR,'$YARN_TMP_DIR',g' $HADOOP_CONF_DIR/yarn-site.xml
sed -i 's,CONFIGURE_YARN_TMP_DIR,'$YARN_TMP_DIR',g' $HADOOP_CONF_DIR/yarn-env.sh
sed -i 's,CONFIGURE_YARN_RESOURCEMANAGER,'$YARN_RESOURCEMANAGER',g' $HADOOP_CONF_DIR/yarn-site.xml

# Spark
sed -i 's,CONFIGURE_SPARK_YARN_STAGING_DIR,'$PROJECT_TMP'/spark-yarn-staging-dir,g' $SPARK_CONF_DIR/spark-defaults.conf
sed -i 's,CONFIGURE_SPARK_YARN_JARS,'$PROJECT_HOME'/spark/jars/*,g' $SPARK_CONF_DIR/spark-defaults.conf

# Cobald/Tardis
CLUSTER_CAPACITY=72 # Physical cores on the sg machines, same as condor slots.
sed -i 's,CONFIGURE_COBALD_TARDIS_CLUSTER_CAPACITY,'$CLUSTER_CAPACITY',g' $COBALD_TARDIS_CONFIG_DIR/cobald.yml
sed -i 's,CONFIGURE_COBALD_TARDIS_CLUSTER_CAPACITY,'$CLUSTER_CAPACITY',g' $COBALD_TARDIS_CONFIG_DIR/tardis.yml
sed -i 's,CONFIGURE_YARN_RESOURCEMANAGER,'$YARN_RESOURCEMANAGER',g' $COBALD_TARDIS_CONFIG_DIR/tardis.yml
sed -i 's,CONFIGURE_COBALD_TARDIS_DRONES_DATABASE,'$COBALD_TARDIS_DRONES_DATABASE',g' $COBALD_TARDIS_CONFIG_DIR/tardis.yml
sed -i 's,CONFIGURE_COBALD_TARDIS_CONDOR_LOG_DIR,'$COBALD_TARDIS_CONDOR_LOG_DIR',g' $COBALD_TARDIS_CONFIG_DIR/drone.jdl
sed -i 's,CONFIGURE_PROJECT_HOME,'$PROJECT_HOME',g' $COBALD_TARDIS_CONFIG_DIR/drone.sh
